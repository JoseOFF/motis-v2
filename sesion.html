<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inicio de sesión</title>
  <link rel="icon" href="assets/img/logo.png" type="image/png">

  <!-- Estilos principales -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/jquery.mCustomScrollbar.css">
  <link rel="stylesheet" href="css/material-design-iconic-font.min.css">
  <link rel="stylesheet" href="css/sweet-alert.css">
  <link rel="stylesheet" href="css/style.css">

  <!-- jQuery desde CDN con fallback -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script>
    window.jQuery || document.write('<script src="js/jquery-1.11.2.min.js"><\/script>')
  </script>

  <!-- Scripts de diseño y funcionalidad -->
  <script src="js/modernizr.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
  <script src="js/sweet-alert.min.js"></script>
  <script src="js/main.js"></script>

  <!-- SDK de Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <!-- Inicializador de Supabase (debes tener supabaseCliente definido aquí) -->
  <script src="supabase-init.js"></script>
  
</head>
<body>
  <!-- Contenedor principal de la página de login -->
  <div class="login-container full-cover-background">
    <div class="form-container">

      <!-- Ícono superior -->
      <p class="text-center" style="margin-top: 17px;">
        <i class="zmdi zmdi-account-circle zmdi-hc-5x"></i>
      </p>
      <h4 class="text-center all-tittles" style="margin-bottom: 30px;">
        Inicia sesión con tu cuenta
      </h4>

      <!-- Formulario de inicio de sesión -->
      <form onsubmit="return validarLogin(event)">
        <!-- Campo de usuario -->
        <div class="group-material-login">
          <input type="text" id="usuario" class="material-login-control" required maxlength="70">
          <span class="highlight-login"></span>
          <span class="bar-login"></span>
          <label><i class="zmdi zmdi-account"></i> &nbsp; Nombres</label>
        </div>
        <br>

        <!-- Campo de contraseña -->
        <div class="group-material-login">
          <input type="password" id="contrasena" class="material-login-control" required maxlength="70">
          <span class="highlight-login"></span>
          <span class="bar-login"></span>
          <label><i class="zmdi zmdi-lock"></i> &nbsp; Contraseña</label>
        </div>

        <!-- Botón de ingreso -->
        <button class="btn-login" type="submit">
          Ingresar al sistema &nbsp; <i class="zmdi zmdi-arrow-right"></i>
        </button>

        <!-- Enlace para crear cuenta -->
        <a href="crearUsuario.html" class="btn-login" style="position: absolute; bottom: 20px; left: -200px;">
          Crear cuenta &nbsp; <i class="zmdi zmdi-arrow-right"></i>
        </a>
      </form>

    </div>   
  </div>

  <!-- Script con la lógica de inicio de sesión -->
  <script>
    /**
     * Función que valida el login de un usuario usando Supabase.
     * Verifica si el usuario existe con el nombre y contraseña ingresados.
     */
    async function validarLogin(event) {
      event.preventDefault();

      const usuario = document.getElementById('usuario').value.trim();
      const contrasena = document.getElementById('contrasena').value.trim();

      // Consulta a Supabase para validar credenciales
      const { data, error } = await supabaseCliente
        .from('Usuarios')
        .select('*')
        .eq('nombre_usuario', usuario)
        .eq('contrasena', contrasena)
        .maybeSingle();

      // Manejo de errores y autenticación
      if (error) {
        console.error('Error:', error);
        swal("Error", "Hubo un problema al conectar con la base de datos", "error");
      } else if (!data) {
        swal("Error", "Usuario o contraseña incorrectos", "error");
      } else {
        // Redirige a la página principal si las credenciales son correctas
        window.location.href = "home.html";
      }
    }
  </script>
</body>
</html>
